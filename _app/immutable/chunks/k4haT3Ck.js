import"./CWj6FrbW.js";import{p as W,e as X,o as Y,f as Z,t as x,a as $,h as tt,s as L,g as m,b as et,d as _}from"./B-fbdRLl.js";import{i as at,e as nt}from"./CA4cFvoh.js";import{f as p,a as A}from"./CJ4bccHK.js";import{a as it,e as rt,b as st,r as ot,g as R,c as ct,o as ft,Q as lt,l as mt,s as dt}from"./Cw4XXSY5.js";import{s as ht}from"./9bAGGAHO.js";import{s as T}from"./CZhv3xky.js";import{b as ut}from"./Dw9IwxVR.js";import{p as k}from"./DF75cDRs.js";import{d as gt}from"./CLTjDgnO.js";var yt=p('<link rel="stylesheet" type="text/css"/>'),vt=p('<div class="markmap-highlight-area"></div>'),wt=p('<!> <!> <svg xmlns="http://www.w3.org/2000/svg"></svg>',1);function qt(J,i){W(i,!0);let h=k(i,"content",7,""),O=k(i,"style",3,""),S=k(i,"fit",3,!0),D=k(i,"class",3,"");const E=it(),j={};let r,b,u;const g={};let c=et(void 0);function F(t,e){let a=!1;return{promise:new Promise((s,f)=>{const o=performance.now(),l=()=>{const d=performance.now()-o,y=Math.min(d/t,1);if(e(y),y<1&&!a)return requestAnimationFrame(l);(a?f:s)()};requestAnimationFrame(l)}),abort:()=>{a=!0}}}function B(t,e){const n={key:Symbol("highlight"),x:t.x,y:t.y,width:t.width,height:t.height,opacity:1,scale:(e.width+8)/e.width};_(c,n,!0);const{abort:s,promise:f}=F(500,o=>{var l;if(n.key!==((l=m(c))==null?void 0:l.key))return s();n.opacity=1-o,_(c,n,!0)});f.finally(()=>{var o;n.key===((o=m(c))==null?void 0:o.key)&&_(c,void 0)})}function H(){return r}async function P(t){var a;if(!r)return;const e=V(t);if(e){await r[j.placement==="center"?"centerNode":"ensureVisible"](e,{bottom:60});const n=(a=r.findElement(e))==null?void 0:a.g,s=n==null?void 0:n.querySelector("foreignObject"),f=s==null?void 0:s.getBoundingClientRect();f&&B(f,e.state.rect)}}const M=gt(()=>r.fit(),200);let C;async function v(t,e=!1){var a,n,s,f;if(r&&(t!==C||e)){u=R().transform(t||"");const o=(a=u.frontmatter)==null?void 0:a.markmap;j.placement=(n=o==null?void 0:o.activeNode)==null?void 0:n.placement;const l=ft(o),{extraJs:d,extraCss:y}=o||{};g.js&&!Q(g.js,d)?(s=i.onReload)==null||s.call(i):!g.js&&d&&(g.js=d,U()),g.css=y,C=t,await r.setData(u.root,{...lt,...l}),(f=i.onUpdate)==null||f.call(i),S()&&await r.fit()}}function Q(t,e){return Array.isArray(t)&&Array.isArray(e)&&t.length===e.length&&t.every((a,n)=>a===e[n])}async function U(){await E,await mt(g.js.map(t=>({type:"script",data:{src:t}}))),v(h(),!0)}function V(t){function e(n){var o,l,d;const[s,f]=((l=(o=n.payload)==null?void 0:o.lines)==null?void 0:l.split(",").map(y=>+y))||[];s>=0&&s<=t&&t<f&&(a=n),(d=n.children)==null||d.forEach(e)}let a;return u!=null&&u.root&&e(u.root),a}function G(t){var a,n;const e=(a=t.target)==null?void 0:a.closest("a");if(e){const s=e.getAttribute("href");((n=i.onOpenLink)==null?void 0:n.call(i,s))===!1&&t.preventDefault()}}X(()=>{h(h()),tt(()=>{v(h())})});async function I(){var e;await E;const t=[ot.tap(()=>{v(h(),!0)}),R().hooks.retransform.tap(()=>{v(h(),!0)})];return r=ct.create(b),v(h()),(e=i.onLoad)==null||e.call(i),window.addEventListener("resize",M),()=>{var a;window.removeEventListener("resize",M),t.forEach(n=>{n()}),(a=r==null?void 0:r.destroy)==null||a.call(r),r=void 0}}Y(()=>{const t=I();return()=>{t.then(e=>e==null?void 0:e())}});var N=wt(),q=Z(N);rt(q,17,()=>g.css||[],st,(t,e)=>{var a=yt();x(()=>dt(a,"href",m(e))),A(t,a)});var z=L(q,2);{var K=t=>{var e=vt();x(()=>T(e,`left:${m(c).x}px;top:${m(c).y}px;width:${m(c).width}px;height:${m(c).height}px;opacity:${m(c).opacity};transform:scale(${m(c).scale})`)),A(t,e)};at(z,t=>{m(c)&&t(K)})}var w=L(z,2);return ut(w,t=>b=t,()=>b),x(()=>{ht(w,0,`${D()} leading-none`),T(w,O())}),nt("click",w,G),A(J,N),$({getMarkmap:H,setCursor:P})}export{qt as M};
